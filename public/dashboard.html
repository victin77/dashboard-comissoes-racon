<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard ‚Ä¢ Comiss√µes</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body data-theme="light">
<header class="sticky top-0 z-50" style="border-bottom:1px solid var(--border); background:rgba(255,255,255,.06); backdrop-filter:blur(12px);">
  <div class="max-w-7xl mx-auto p-4 flex flex-wrap items-center justify-between gap-3">
    <div>
      <div class="text-2xl font-black">Dashboard de Comiss√µes</div>
      <div id="meLine" class="text-sm muted">‚Äî</div>
    </div>
    <div class="flex items-center gap-2">
      <span class="chip">Limite cr√©dito: R$ 1.500.000</span>
      <button id="btnTheme" class="btn">üåô</button>
      <button id="btnLogout" class="btn">Sair</button>
    </div>
  </div>
</header>

<main class="max-w-7xl mx-auto p-4 space-y-4">

  <!-- CARDS -->
  <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <div class="panel p-4">
      <div class="text-xs font-black muted">Comiss√£o Total</div>
      <div id="kpiTotal" class="text-2xl font-black mt-1">‚Äî</div>
      <div id="kpiVendas" class="text-xs muted mt-1">‚Äî</div>
    </div>

    <div class="panel p-4" style="border-color: rgba(16,185,129,.35);">
      <div class="text-xs font-black muted">Pagas</div>
      <div id="kpiPago" class="text-2xl font-black mt-1" style="color:var(--good);">‚Äî</div>
      <div id="kpiPagoPct" class="text-xs muted mt-1">‚Äî</div>
    </div>

    <div class="panel p-4" style="border-color: rgba(245,158,11,.35);">
      <div class="text-xs font-black muted">Pendentes</div>
      <div id="kpiPendente" class="text-2xl font-black mt-1" style="color:var(--warn);">‚Äî</div>
      <div id="kpiPendenteInfo" class="text-xs muted mt-1">‚Äî</div>
    </div>

    <div class="panel p-4" style="border-color: rgba(239,68,68,.35);">
      <div class="text-xs font-black muted">Atrasadas</div>
      <div id="kpiAtrasado" class="text-2xl font-black mt-1" style="color:var(--bad);">‚Äî</div>
      <div id="kpiAtrasadoInfo" class="text-xs muted mt-1">‚Äî</div>
    </div>
  </section>

  <!-- RESUMO + RANKING -->
  <section class="grid grid-cols-1 lg:grid-cols-12 gap-4">
    <div class="lg:col-span-5 glass p-4">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-lg font-black">Resumo r√°pido</div>
          <div class="text-sm muted">Uma vis√£o direta do que importa</div>
        </div>
        <button id="btnRefresh" class="btn">üîÑ Atualizar</button>
      </div>

      <div class="mt-4 space-y-3">
        <div class="panel p-4">
          <div class="text-xs font-black muted">Top consultor (por valor pago)</div>
          <div id="quickTop" class="text-xl font-black mt-1">‚Äî</div>
          <div id="quickTopSub" class="text-xs muted mt-1">‚Äî</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="panel p-4">
            <div class="text-xs font-black muted">Ticket m√©dio (comiss√£o)</div>
            <div id="quickTicket" class="text-xl font-black mt-1">‚Äî</div>
          </div>
          <div class="panel p-4">
            <div class="text-xs font-black muted">Parcelas (total)</div>
            <div id="quickParcelas" class="text-xl font-black mt-1">‚Äî</div>
          </div>
        </div>

        <div class="panel p-4">
          <div class="text-xs font-black muted">Situa√ß√£o geral</div>
          <div id="quickMix" class="text-sm mt-2 muted">‚Äî</div>
        </div>
      </div>
    </div>

    <div id="rankingSection" class="lg:col-span-7 panel p-4">
      <div class="text-lg font-black">Ranking de consultores</div>
      <div class="text-sm muted">Ordenado por valor pago (e mostra total e n√∫mero de vendas)</div>


      <div class="mt-4 grid grid-cols-1 lg:grid-cols-12 gap-4">
        <div class="lg:col-span-12 panel p-4">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-sm font-black">Gr√°fico</div>
              <div class="text-xs muted">Passe o mouse para ver detalhes ‚Ä¢ Clique em um m√™s para filtrar</div>
            </div>
            <div class="text-xs muted">Base: comiss√£o (parcelas)</div>
          </div>
          <div class="mt-3">
            <canvas id="chartComissoes" height="110"></canvas>
          </div>
        </div>
      </div>

      <div class="mt-4 tableWrap">
        <div class="overflow-auto">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Consultor</th>
                <th>Vendas</th>
                <th>Total comiss√£o</th>
                <th>Pago</th>
                <th>Pendente</th>
                <th>Atrasado</th>
              </tr>
            </thead>
            <tbody id="rankBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- FORM + TABELA -->
  <section class="grid grid-cols-1 lg:grid-cols-12 gap-4">
    <div class="lg:col-span-4 panel p-4">
      <div class="text-lg font-black">Adicionar venda</div>
      <form id="formAdd" class="mt-3 space-y-2">
        <div id="adminExtras" style="display:none;">
          <label class="text-xs font-black muted">Admin: nome do consultor</label>
          <input name="consultorName" class="input mt-1" placeholder="Ex: Pedro" />
          <label class="text-xs font-black muted mt-2 block">Admin: userId (opcional)</label>
          <input name="userId" class="input mt-1" placeholder="Se vazio, fica no admin" />
          <div class="text-xs muted mt-1">Depois eu coloco seletor autom√°tico de consultor.</div>
        </div>

        <input name="cliente" class="input" placeholder="Cliente" required />
        <input name="produto" class="input" placeholder="Produto" required />
        <input name="data" class="input" type="date" required />

        <div class="grid grid-cols-2 gap-2">
          <select name="seguro" class="select">
            <option>Sim</option>
            <option selected>N√£o</option>
          </select>
          <select name="baseComissao" class="select">
            <option value="credito" selected>Base: Cr√©dito</option>
            <option value="venda">Base: Valor venda</option>
          </select>
        </div>

        <div class="grid grid-cols-2 gap-2">
          <input name="cotas" class="input" inputmode="numeric" placeholder="Cotas" required />
          <input name="valorUnit" class="input" inputmode="decimal" placeholder="Valor unit√°rio" required />
        </div>

        <div class="grid grid-cols-2 gap-2">
          <input name="valorVenda" class="input" inputmode="decimal" placeholder="Valor venda (se base venda)" />
          <input name="taxaPct" class="input" inputmode="decimal" placeholder="Comiss√£o % (ex: 0,8)" required />
        </div>

        <div class="panel p-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-xs muted font-black">Cr√©dito</div>
              <div id="pvCredito" class="font-black">‚Äî</div>
              <div id="pvCreditoFinal" class="text-xs muted" style="display:none;">‚Äî</div>
            </div>
            <div class="text-right">
              <div class="text-xs muted font-black">Comiss√£o total</div>
              <div id="pvComissao" class="font-black" style="color:var(--accent);">‚Äî</div>
              <div class="text-xs muted font-black mt-1">Parcela (1/6)</div>
              <div id="pvParcela" class="font-black">‚Äî</div>
            </div>
          </div>
          <p id="pvWarn" class="text-xs" style="display:none; color:var(--warn); font-weight:900; margin-top:8px;"></p>
        </div>

        <p id="addErr" class="text-sm" style="display:none; color:var(--bad); font-weight:900;"></p>
        <button class="btn btn-primary w-full">Salvar</button>
      </form>
    </div>

    <div class="lg:col-span-8 glass p-4">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-lg font-black">Vendas</div>
          <div class="text-sm muted">Consultor v√™ s√≥ as pr√≥prias ‚Ä¢ Admin v√™ todas</div>
          <div class="mt-3 grid grid-cols-1 lg:grid-cols-12 gap-2">
            <div class="lg:col-span-3">
              <label class="text-xs font-black muted">De</label>
              <input id="fDateFrom" class="input mt-1" type="date" />
            </div>
            <div class="lg:col-span-3">
              <label class="text-xs font-black muted">At√©</label>
              <input id="fDateTo" class="input mt-1" type="date" />
            </div>
            <div class="lg:col-span-3">
              <label class="text-xs font-black muted">Status</label>
              <select id="fStatus" class="select mt-1">
                <option value="todos" selected>Todos</option>
                <option value="Pago">Pago</option>
                <option value="Pendente">Pendente</option>
                <option value="Atrasado">Atrasado</option>
              </select>
            </div>
            <div id="fConsultorWrap" class="lg:col-span-3" style="display:none;">
              <label class="text-xs font-black muted">Consultor</label>
              <select id="fConsultor" class="select mt-1">
                <option value="todos" selected>Todos</option>
              </select>
            </div>

            <div class="lg:col-span-6">
              <label class="text-xs font-black muted">Buscar (cliente / produto)</label>
              <input id="fSearch" class="input mt-1" placeholder="Ex: Jo√£o, Im√≥vel, Auto..." />
            </div>

            <div class="lg:col-span-6 flex flex-wrap items-end gap-2">
              <button id="btnClearFilters" class="btn">Limpar filtros</button>
              <button id="btnExportCsv" class="btn">‚¨áÔ∏è Exportar CSV</button>
              <button id="btnExportXlsx" class="btn btn-primary">‚¨áÔ∏è Exportar Excel</button>
            </div>
          </div>

        </div>
      </div>

      <div class="mt-4 tableWrap">
        <div class="overflow-auto">
          <table>
            <thead>
              <tr>
                <th>Consultor</th>
                <th>Cliente</th>
                <th>Produto</th>
                <th>Data</th>
                <th>Seguro</th>
                <th>Cotas</th>
                <th>Unit.</th>
                <th>Cr√©dito</th>
                <th>Base</th>
                <th>%</th>
                <th>Comiss√£o</th>
                <th style="text-align:right;">A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

</main>

<script src="/dashboard.js"></script>

<!-- MODAL DETALHES/EDI√á√ÉO -->
<div id="saleModal" class="fixed inset-0 z-50" style="display:none;">
  <div class="absolute inset-0" style="background:rgba(0,0,0,.55);"></div>
  <div class="relative max-w-3xl mx-auto mt-10 p-4">
    <div class="glass p-4">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="text-lg font-black">Detalhes da venda</div>
          <div id="modalSub" class="text-xs muted">‚Äî</div>
        </div>
        <div class="flex gap-2">
          <button id="btnDeleteSale" class="btn" style="border-color: rgba(239,68,68,.35); color: var(--bad);">Excluir</button>
          <button id="btnCloseModal" class="btn">Fechar</button>
        </div>
      </div>

      <form id="formEdit" class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3">
        <div id="editAdminBlock" class="md:col-span-2" style="display:none;">
          <div class="panel p-3">
            <div class="text-xs font-black muted">Campos de admin</div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
              <input name="consultorName" class="input" placeholder="Nome do consultor" />
              <input name="userId" class="input" placeholder="userId (opcional)" />
            </div>
          </div>
        </div>

        <input name="cliente" class="input" placeholder="Cliente" required />
        <input name="produto" class="input" placeholder="Produto" required />
        <input name="data" class="input" type="date" required />

        <select name="seguro" class="select">
          <option>Sim</option>
          <option selected>N√£o</option>
        </select>

        <select name="baseComissao" class="select">
          <option value="credito" selected>Base: Cr√©dito</option>
          <option value="venda">Base: Valor venda</option>
        </select>

        <input name="cotas" class="input" inputmode="numeric" placeholder="Cotas" required />
        <input name="valorUnit" class="input" inputmode="decimal" placeholder="Valor unit√°rio" required />
        <input name="valorVenda" class="input" inputmode="decimal" placeholder="Valor venda (se base venda)" />
        <input name="taxaPct" class="input" inputmode="decimal" placeholder="Comiss√£o % (ex: 0,8)" required />

        <div class="md:col-span-2 panel p-3">
          <div class="flex items-center justify-between">
            <div class="text-xs font-black muted">Parcelas (6x)</div>
            <div class="text-xs muted">Clique para alternar</div>
          </div>
          <div id="parcelasEdit" class="mt-2 grid grid-cols-3 md:grid-cols-6 gap-2"></div>
          <div class="text-xs muted mt-2">Ordem: 1/6 at√© 6/6</div>
        </div>

        <p id="editErr" class="text-sm md:col-span-2" style="display:none; color:var(--bad); font-weight:900;"></p>
        <div class="md:col-span-2 flex flex-wrap gap-2 justify-end">
          <button id="btnSaveEdit" class="btn btn-primary" type="submit">Salvar altera√ß√µes</button>
        </div>
      </form>
    </div>
  </div>
</div>

</body>
</html>
