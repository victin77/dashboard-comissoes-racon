<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard ‚Ä¢ Comiss√µes</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body data-theme="light">
<header class="sticky top-0 z-50" style="border-bottom:1px solid var(--border); background:rgba(255,255,255,.06); backdrop-filter:blur(12px);">
  <div class="max-w-7xl mx-auto p-4 flex flex-wrap items-center justify-between gap-3">
    <div>
      <div class="text-2xl font-black">Dashboard de Comiss√µes</div>
      <div id="meLine" class="text-sm muted">‚Äî</div>
    </div>
    <div class="flex items-center gap-2">
      <span class="chip">Limite cr√©dito: R$ 1.500.000</span>
      <button id="btnTheme" class="btn">üåô</button>
      <button id="btnLogout" class="btn">Sair</button>
    </div>
  </div>
</header>

<main class="max-w-7xl mx-auto p-4 space-y-4">

  <!-- CARDS -->
  <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <div class="panel p-4">
      <div class="text-xs font-black muted">Comiss√£o Total</div>
      <div id="kpiTotal" class="text-2xl font-black mt-1">‚Äî</div>
      <div id="kpiVendas" class="text-xs muted mt-1">‚Äî</div>
    </div>

    <div class="panel p-4" style="border-color: rgba(16,185,129,.35);">
      <div class="text-xs font-black muted">Pagas</div>
      <div id="kpiPago" class="text-2xl font-black mt-1" style="color:var(--good);">‚Äî</div>
      <div id="kpiPagoPct" class="text-xs muted mt-1">‚Äî</div>
    </div>

    <div class="panel p-4" style="border-color: rgba(245,158,11,.35);">
      <div class="text-xs font-black muted">Pendentes</div>
      <div id="kpiPendente" class="text-2xl font-black mt-1" style="color:var(--warn);">‚Äî</div>
      <div id="kpiPendenteInfo" class="text-xs muted mt-1">‚Äî</div>
    </div>

    <div class="panel p-4" style="border-color: rgba(239,68,68,.35);">
      <div class="text-xs font-black muted">Atrasadas</div>
      <div id="kpiAtrasado" class="text-2xl font-black mt-1" style="color:var(--bad);">‚Äî</div>
      <div id="kpiAtrasadoInfo" class="text-xs muted mt-1">‚Äî</div>
    </div>
  </section>

  <!-- RESUMO + RANKING -->
  <section class="grid grid-cols-1 lg:grid-cols-12 gap-4">
    <div class="lg:col-span-5 glass p-4">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-lg font-black">Resumo r√°pido</div>
          <div class="text-sm muted">Uma vis√£o direta do que importa</div>
        </div>
        <button id="btnRefresh" class="btn">üîÑ Atualizar</button>
      </div>

      <div class="mt-4 space-y-3">
        <div class="panel p-4">
          <div class="text-xs font-black muted">Top consultor (por valor pago)</div>
          <div id="quickTop" class="text-xl font-black mt-1">‚Äî</div>
          <div id="quickTopSub" class="text-xs muted mt-1">‚Äî</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="panel p-4">
            <div class="text-xs font-black muted">Ticket m√©dio (comiss√£o)</div>
            <div id="quickTicket" class="text-xl font-black mt-1">‚Äî</div>
          </div>
          <div class="panel p-4">
            <div class="text-xs font-black muted">Parcelas (total)</div>
            <div id="quickParcelas" class="text-xl font-black mt-1">‚Äî</div>
          </div>
        </div>

        <div class="panel p-4">
          <div class="text-xs font-black muted">Situa√ß√£o geral</div>
          <div id="quickMix" class="text-sm mt-2 muted">‚Äî</div>
        </div>
      </div>
    </div>

    <div class="lg:col-span-7 panel p-4">
      <div class="text-lg font-black">Ranking de consultores</div>
      <div class="text-sm muted">Ordenado por valor pago (e mostra total e n√∫mero de vendas)</div>

      <div class="mt-4 tableWrap">
        <div class="overflow-auto">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Consultor</th>
                <th>Vendas</th>
                <th>Total comiss√£o</th>
                <th>Pago</th>
                <th>Pendente</th>
                <th>Atrasado</th>
              </tr>
            </thead>
            <tbody id="rankBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- FORM + TABELA -->
  <section class="grid grid-cols-1 lg:grid-cols-12 gap-4">
    <div class="lg:col-span-4 panel p-4">
      <div class="text-lg font-black">Adicionar venda</div>
      <form id="formAdd" class="mt-3 space-y-2">
        <div id="adminExtras" style="display:none;">
          <label class="text-xs font-black muted">Admin: nome do consultor</label>
          <input name="consultorName" class="input mt-1" placeholder="Ex: Pedro" />
          <label class="text-xs font-black muted mt-2 block">Admin: userId (opcional)</label>
          <input name="userId" class="input mt-1" placeholder="Se vazio, fica no admin" />
          <div class="text-xs muted mt-1">Depois eu coloco seletor autom√°tico de consultor.</div>
        </div>

        <input name="cliente" class="input" placeholder="Cliente" required />
        <input name="produto" class="input" placeholder="Produto" required />
        <input name="data" class="input" type="date" required />

        <div class="grid grid-cols-2 gap-2">
          <select name="seguro" class="select">
            <option>Sim</option>
            <option selected>N√£o</option>
          </select>
          <select name="baseComissao" class="select">
            <option value="credito" selected>Base: Cr√©dito</option>
            <option value="venda">Base: Valor venda</option>
          </select>
        </div>

        <div class="grid grid-cols-2 gap-2">
          <input name="cotas" class="input" inputmode="numeric" placeholder="Cotas" required />
          <input name="valorUnit" class="input" inputmode="decimal" placeholder="Valor unit√°rio" required />
        </div>

        <div class="grid grid-cols-2 gap-2">
          <input name="valorVenda" class="input" inputmode="decimal" placeholder="Valor venda (se base venda)" />
          <input name="taxaPct" class="input" inputmode="decimal" placeholder="Comiss√£o % (ex: 0,8)" required />
        </div>

        <div class="panel p-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-xs muted font-black">Cr√©dito</div>
              <div id="pvCredito" class="font-black">‚Äî</div>
              <div id="pvCreditoFinal" class="text-xs muted" style="display:none;">‚Äî</div>
            </div>
            <div class="text-right">
              <div class="text-xs muted font-black">Comiss√£o total</div>
              <div id="pvComissao" class="font-black" style="color:var(--accent);">‚Äî</div>
              <div class="text-xs muted font-black mt-1">Parcela (1/6)</div>
              <div id="pvParcela" class="font-black">‚Äî</div>
            </div>
          </div>
          <p id="pvWarn" class="text-xs" style="display:none; color:var(--warn); font-weight:900; margin-top:8px;"></p>
        </div>

        <p id="addErr" class="text-sm" style="display:none; color:var(--bad); font-weight:900;"></p>
        <button class="btn btn-primary w-full">Salvar</button>
      </form>
    </div>

    <div class="lg:col-span-8 glass p-4">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-lg font-black">Vendas</div>
          <div class="text-sm muted">Consultor v√™ s√≥ as pr√≥prias ‚Ä¢ Admin v√™ todas</div>
        </div>
        <div class="flex items-center gap-2 flex-wrap justify-end">
          <input id="q" class="input" style="max-width:240px" placeholder="Buscar (cliente / produto / consultor)" />
          <button id="btnFilters" class="btn">üß∞ Filtros</button>
          <button id="btnExport" class="btn">‚¨áÔ∏è Exportar</button>
        </div>
      </div>

      <!-- FILTROS (colaps√°vel) -->
      <div id="filtersBar" class="panel p-3 mt-3" style="display:none;">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-2">
          <select id="fConsultor" class="select">
            <option value="">Todos consultores</option>
          </select>
          <select id="fStatus" class="select">
            <option value="">Todos status</option>
            <option value="Pago">Pago</option>
            <option value="Pendente">Pendente</option>
            <option value="Atrasado">Atrasado</option>
          </select>
          <input id="fFrom" class="input" type="date" />
          <input id="fTo" class="input" type="date" />
        </div>
        <div class="flex items-center justify-between flex-wrap gap-2 mt-2">
          <div class="text-xs muted">Dica: o filtro de status olha as 6 parcelas da comiss√£o.</div>
          <div class="flex gap-2">
            <button id="btnClearFilters" class="btn">Limpar</button>
            <button id="btnApplyFilters" class="btn btn-primary">Aplicar</button>
          </div>
        </div>
      </div>

      <div class="mt-4 tableWrap">
        <div class="overflow-auto">
          <table>
            <thead>
              <tr>
                <th>Consultor</th>
                <th>Cliente</th>
                <th>Produto</th>
                <th>Data</th>
                <th>Seguro</th>
                <th>Cotas</th>
                <th>Unit.</th>
                <th>Cr√©dito</th>
                <th>Base</th>
                <th>%</th>
                <th>Comiss√£o</th>
                <th style="text-align:right;">A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- MODAL DETALHAR -->
  <div id="detailWrap" style="display:none;" class="fixed inset-0 z-50">
    <div class="absolute inset-0" style="background: rgba(0,0,0,.55);"></div>
    <div class="absolute inset-0 p-4 overflow-auto">
      <div class="max-w-4xl mx-auto panel p-4" style="border:1px solid var(--border);">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-xl font-black">Detalhar venda</div>
            <div id="detailSub" class="text-sm muted">‚Äî</div>
          </div>
          <div class="flex gap-2">
            <button id="btnAutoLate" class="btn">‚è± Marcar vencidas</button>
            <button id="btnCloseDetail" class="btn">‚úñ Fechar</button>
          </div>
        </div>

        <form id="detailForm" class="mt-4 space-y-3">
          <div id="detailAdmin" style="display:none;" class="grid grid-cols-1 md:grid-cols-2 gap-2">
            <div>
              <label class="text-xs font-black muted">Consultor (nome)</label>
              <input name="consultorName" class="input mt-1" />
            </div>
            <div>
              <label class="text-xs font-black muted">userId</label>
              <input name="userId" class="input mt-1" />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
            <div>
              <label class="text-xs font-black muted">Cliente</label>
              <input name="cliente" class="input mt-1" required />
            </div>
            <div>
              <label class="text-xs font-black muted">Produto</label>
              <input name="produto" class="input mt-1" required />
            </div>
            <div>
              <label class="text-xs font-black muted">Data da venda</label>
              <input name="data" class="input mt-1" type="date" required />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-4 gap-2">
            <div>
              <label class="text-xs font-black muted">Seguro</label>
              <select name="seguro" class="select mt-1">
                <option>Sim</option>
                <option>N√£o</option>
              </select>
            </div>
            <div>
              <label class="text-xs font-black muted">Base comiss√£o</label>
              <select name="baseComissao" class="select mt-1">
                <option value="credito">Cr√©dito</option>
                <option value="venda">Valor venda</option>
              </select>
            </div>
            <div>
              <label class="text-xs font-black muted">Cotas</label>
              <input name="cotas" class="input mt-1" inputmode="numeric" />
            </div>
            <div>
              <label class="text-xs font-black muted">Valor unit√°rio</label>
              <input name="valorUnit" class="input mt-1" inputmode="decimal" />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
            <div>
              <label class="text-xs font-black muted">Valor venda (se base venda)</label>
              <input name="valorVenda" class="input mt-1" inputmode="decimal" />
            </div>
            <div>
              <label class="text-xs font-black muted">Comiss√£o %</label>
              <input name="taxaPct" class="input mt-1" inputmode="decimal" />
            </div>
            <div class="panel p-3">
              <div class="text-xs font-black muted">Pr√©via</div>
              <div id="detailPreview" class="text-sm muted mt-1">‚Äî</div>
            </div>
          </div>

          <div class="panel p-3">
            <div class="text-sm font-black">Parcelas (6)</div>
            <div class="text-xs muted">Vencimento: 1 m√™s ap√≥s a venda ‚Ä¢ Voc√™ pode marcar como pago/atrasado.</div>
            <div class="overflow-auto mt-2">
              <table>
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Vencimento</th>
                    <th>Status</th>
                    <th style="text-align:right;">A√ß√µes</th>
                  </tr>
                </thead>
                <tbody id="parcelasBody"></tbody>
              </table>
            </div>
          </div>

          <p id="detailErr" class="text-sm" style="display:none; color:var(--bad); font-weight:900;"></p>
          <div class="flex items-center justify-end gap-2">
            <button type="button" id="btnDeleteInDetail" class="btn">üóë Excluir</button>
            <button class="btn btn-primary" type="submit">üíæ Salvar altera√ß√µes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

</main>

<script src="/dashboard.js"></script>
</body>
</html>
